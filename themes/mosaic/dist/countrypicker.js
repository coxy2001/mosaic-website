var countries = [
    {
        "name": "Afghanistan",
        "code": "af",
        "selected": 1
    },
    {
        "name": "Ã…land Islands",
        "code": "ax",
        "selected": 1
    },
    {
        "name": "Albania",
        "code": "al",
        "selected": 1
    },
    {
        "name": "Algeria",
        "code": "dz",
        "selected": 1
    },
    {
        "name": "American Samoa",
        "code": "as",
        "selected": 1
    },
    {
        "name": "Andorra",
        "code": "ad",
        "selected": 1
    },
    {
        "name": "Angola",
        "code": "ao",
        "selected": 1
    },
    {
        "name": "Anguilla",
        "code": "ai",
        "selected": 1
    },
    {
        "name": "Antarctica",
        "code": "aq",
        "selected": 1
    },
    {
        "name": "Antigua and Barbuda",
        "code": "ag",
        "selected": 1
    },
    {
        "name": "Argentina",
        "code": "ar",
        "selected": 1
    },
    {
        "name": "Armenia",
        "code": "am",
        "selected": 1
    },
    {
        "name": "Aruba",
        "code": "aw",
        "selected": 1
    },
    {
        "name": "Australia",
        "code": "au",
        "selected": 1
    },
    {
        "name": "Austria",
        "code": "at",
        "selected": 1
    },
    {
        "name": "Azerbaijan",
        "code": "az",
        "selected": 1
    },
    {
        "name": "Bahamas",
        "code": "bs",
        "selected": 1
    },
    {
        "name": "Bahrain",
        "code": "bh",
        "selected": 1
    },
    {
        "name": "Bangladesh",
        "code": "bd",
        "selected": 1
    },
    {
        "name": "Barbados",
        "code": "bb",
        "selected": 1
    },
    {
        "name": "Belarus",
        "code": "by",
        "selected": 1
    },
    {
        "name": "Belgium",
        "code": "be",
        "selected": 1
    },
    {
        "name": "Belize",
        "code": "bz",
        "selected": 1
    },
    {
        "name": "Benin",
        "code": "bj",
        "selected": 1
    },
    {
        "name": "Bermuda",
        "code": "bm",
        "selected": 1
    },
    {
        "name": "Bhutan",
        "code": "bt",
        "selected": 1
    },
    {
        "name": "Bolivia",
        "code": "bo",
        "selected": 1
    },
    {
        "name": "Bosnia and Herzegovina",
        "code": "ba",
        "selected": 1
    },
    {
        "name": "Botswana",
        "code": "bw",
        "selected": 1
    },
    {
        "name": "Bouvet Island",
        "code": "bv",
        "selected": 1
    },
    {
        "name": "Brazil",
        "code": "br",
        "selected": 1
    },
    {
        "name": "British Indian Ocean Territory",
        "code": "io",
        "selected": 1
    },
    {
        "name": "Brunei Darussalam",
        "code": "bn",
        "selected": 1
    },
    {
        "name": "Bulgaria",
        "code": "bg",
        "selected": 1
    },
    {
        "name": "Burkina Faso",
        "code": "bf",
        "selected": 1
    },
    {
        "name": "Burundi",
        "code": "bi",
        "selected": 1
    },
    {
        "name": "Cambodia",
        "code": "kh",
        "selected": 1
    },
    {
        "name": "Cameroon",
        "code": "cm",
        "selected": 1
    },
    {
        "name": "Canada",
        "code": "ca",
        "selected": 1
    },
    {
        "name": "Cape Verde",
        "code": "cv",
        "selected": 1
    },
    {
        "name": "Cayman Islands",
        "code": "ky",
        "selected": 1
    },
    {
        "name": "Central African Republic",
        "code": "cf",
        "selected": 1
    },
    {
        "name": "Chad",
        "code": "td",
        "selected": 1
    },
    {
        "name": "Chile",
        "code": "cl",
        "selected": 1
    },
    {
        "name": "China",
        "code": "cn",
        "selected": 1
    },
    {
        "name": "Christmas Island",
        "code": "cx",
        "selected": 1
    },
    {
        "name": "Cocos (Keeling) Islands",
        "code": "cc",
        "selected": 1
    },
    {
        "name": "Colombia",
        "code": "co",
        "selected": 1
    },
    {
        "name": "Comoros",
        "code": "km",
        "selected": 1
    },
    {
        "name": "Congo",
        "code": "cg",
        "selected": 1
    },
    {
        "name": "Congo, The Democratic Republic of the",
        "code": "cd",
        "selected": 1
    },
    {
        "name": "Cook Islands",
        "code": "ck",
        "selected": 1
    },
    {
        "name": "Costa Rica",
        "code": "cr",
        "selected": 1
    },
    {
        "name": "Cote D\"Ivoire",
        "code": "ci",
        "selected": 1
    },
    {
        "name": "Croatia",
        "code": "hr",
        "selected": 1
    },
    {
        "name": "Cuba",
        "code": "cu",
        "selected": 1
    },
    {
        "name": "Cyprus",
        "code": "cy",
        "selected": 1
    },
    {
        "name": "Czech Republic",
        "code": "cz",
        "selected": 1
    },
    {
        "name": "Denmark",
        "code": "dk",
        "selected": 1
    },
    {
        "name": "Djibouti",
        "code": "dj",
        "selected": 1
    },
    {
        "name": "Dominica",
        "code": "dm",
        "selected": 1
    },
    {
        "name": "Dominican Republic",
        "code": "do",
        "selected": 1
    },
    {
        "name": "Ecuador",
        "code": "ec",
        "selected": 1
    },
    {
        "name": "Egypt",
        "code": "eg",
        "selected": 1
    },
    {
        "name": "El Salvador",
        "code": "sv",
        "selected": 1
    },
    {
        "name": "Equatorial Guinea",
        "code": "gq",
        "selected": 1
    },
    {
        "name": "Eritrea",
        "code": "er",
        "selected": 1
    },
    {
        "name": "Estonia",
        "code": "ee",
        "selected": 1
    },
    {
        "name": "Ethiopia",
        "code": "et",
        "selected": 1
    },
    {
        "name": "Falkland Islands (Malvinas)",
        "code": "fk",
        "selected": 1
    },
    {
        "name": "Faroe Islands",
        "code": "fo",
        "selected": 1
    },
    {
        "name": "Fiji",
        "code": "fj",
        "selected": 1
    },
    {
        "name": "Finland",
        "code": "fi",
        "selected": 1
    },
    {
        "name": "France",
        "code": "fr",
        "selected": 1
    },
    {
        "name": "French Guiana",
        "code": "gf",
        "selected": 1
    },
    {
        "name": "French Polynesia",
        "code": "pf",
        "selected": 1
    },
    {
        "name": "French Southern Territories",
        "code": "tf",
        "selected": 1
    },
    {
        "name": "Gabon",
        "code": "ga",
        "selected": 1
    },
    {
        "name": "Gambia",
        "code": "gm",
        "selected": 1
    },
    {
        "name": "Georgia",
        "code": "ge",
        "selected": 1
    },
    {
        "name": "Germany",
        "code": "de",
        "selected": 1
    },
    {
        "name": "Ghana",
        "code": "gh",
        "selected": 1
    },
    {
        "name": "Gibraltar",
        "code": "gi",
        "selected": 1
    },
    {
        "name": "Greece",
        "code": "gr",
        "selected": 1
    },
    {
        "name": "Greenland",
        "code": "gl",
        "selected": 1
    },
    {
        "name": "Grenada",
        "code": "gd",
        "selected": 1
    },
    {
        "name": "Guadeloupe",
        "code": "gp",
        "selected": 1
    },
    {
        "name": "Guam",
        "code": "gu",
        "selected": 1
    },
    {
        "name": "Guatemala",
        "code": "gt",
        "selected": 1
    },
    {
        "name": "Guernsey",
        "code": "gg",
        "selected": 1
    },
    {
        "name": "Guinea",
        "code": "gn",
        "selected": 1
    },
    {
        "name": "Guinea-Bissau",
        "code": "gw",
        "selected": 1
    },
    {
        "name": "Guyana",
        "code": "gy",
        "selected": 1
    },
    {
        "name": "Haiti",
        "code": "ht",
        "selected": 1
    },
    {
        "name": "Heard Island and Mcdonald Islands",
        "code": "hm",
        "selected": 1
    },
    {
        "name": "Holy See (Vatican City State)",
        "code": "va",
        "selected": 1
    },
    {
        "name": "Honduras",
        "code": "hn",
        "selected": 1
    },
    {
        "name": "Hong Kong",
        "code": "hk",
        "selected": 1
    },
    {
        "name": "Hungary",
        "code": "hu",
        "selected": 1
    },
    {
        "name": "Iceland",
        "code": "is",
        "selected": 1
    },
    {
        "name": "India",
        "code": "in",
        "selected": 1
    },
    {
        "name": "Indonesia",
        "code": "id",
        "selected": 1
    },
    {
        "name": "Iran, Islamic Republic Of",
        "code": "ir",
        "selected": 1
    },
    {
        "name": "Iraq",
        "code": "iq",
        "selected": 1
    },
    {
        "name": "Ireland",
        "code": "ie",
        "selected": 1
    },
    {
        "name": "Isle of Man",
        "code": "im",
        "selected": 1
    },
    {
        "name": "Israel",
        "code": "il",
        "selected": 1
    },
    {
        "name": "Italy",
        "code": "it",
        "selected": 1
    },
    {
        "name": "Jamaica",
        "code": "jm",
        "selected": 1
    },
    {
        "name": "Japan",
        "code": "jp",
        "selected": 1
    },
    {
        "name": "Jersey",
        "code": "je",
        "selected": 1
    },
    {
        "name": "Jordan",
        "code": "jo",
        "selected": 1
    },
    {
        "name": "Kazakhstan",
        "code": "kz",
        "selected": 1
    },
    {
        "name": "Kenya",
        "code": "ke",
        "selected": 1
    },
    {
        "name": "Kiribati",
        "code": "ki",
        "selected": 1
    },
    {
        "name": "Korea, Democratic People\"S Republic of",
        "code": "kp",
        "selected": 1
    },
    {
        "name": "Korea, Republic of",
        "code": "kr",
        "selected": 1
    },
    {
        "name": "Kuwait",
        "code": "kw",
        "selected": 1
    },
    {
        "name": "Kyrgyzstan",
        "code": "kg",
        "selected": 1
    },
    {
        "name": "Lao People\"S Democratic Republic",
        "code": "la",
        "selected": 1
    },
    {
        "name": "Latvia",
        "code": "lv",
        "selected": 1
    },
    {
        "name": "Lebanon",
        "code": "lb",
        "selected": 1
    },
    {
        "name": "Lesotho",
        "code": "ls",
        "selected": 1
    },
    {
        "name": "Liberia",
        "code": "lr",
        "selected": 1
    },
    {
        "name": "Libyan Arab Jamahiriya",
        "code": "ly",
        "selected": 1
    },
    {
        "name": "Liechtenstein",
        "code": "li",
        "selected": 1
    },
    {
        "name": "Lithuania",
        "code": "lt",
        "selected": 1
    },
    {
        "name": "Luxembourg",
        "code": "lu",
        "selected": 1
    },
    {
        "name": "Macao",
        "code": "mo",
        "selected": 1
    },
    {
        "name": "Macedonia, The Former Yugoslav Republic of",
        "code": "mk",
        "selected": 1
    },
    {
        "name": "Madagascar",
        "code": "mg",
        "selected": 1
    },
    {
        "name": "Malawi",
        "code": "mw",
        "selected": 1
    },
    {
        "name": "Malaysia",
        "code": "my",
        "selected": 1
    },
    {
        "name": "Maldives",
        "code": "mv",
        "selected": 1
    },
    {
        "name": "Mali",
        "code": "ml",
        "selected": 1
    },
    {
        "name": "Malta",
        "code": "mt",
        "selected": 1
    },
    {
        "name": "Marshall Islands",
        "code": "mh",
        "selected": 1
    },
    {
        "name": "Martinique",
        "code": "mq",
        "selected": 1
    },
    {
        "name": "Mauritania",
        "code": "mr",
        "selected": 1
    },
    {
        "name": "Mauritius",
        "code": "mu",
        "selected": 1
    },
    {
        "name": "Mayotte",
        "code": "yt",
        "selected": 1
    },
    {
        "name": "Mexico",
        "code": "mx",
        "selected": 1
    },
    {
        "name": "Micronesia, Federated States of",
        "code": "fm",
        "selected": 1
    },
    {
        "name": "Moldova, Republic of",
        "code": "md",
        "selected": 1
    },
    {
        "name": "Monaco",
        "code": "mc",
        "selected": 1
    },
    {
        "name": "Mongolia",
        "code": "mn",
        "selected": 1
    },
    {
        "name": "Montserrat",
        "code": "ms",
        "selected": 1
    },
    {
        "name": "Morocco",
        "code": "ma",
        "selected": 1
    },
    {
        "name": "Mozambique",
        "code": "mz",
        "selected": 1
    },
    {
        "name": "Myanmar",
        "code": "mm",
        "selected": 1
    },
    {
        "name": "Namibia",
        "code": "na",
        "selected": 1
    },
    {
        "name": "Nauru",
        "code": "nr",
        "selected": 1
    },
    {
        "name": "Nepal",
        "code": "np",
        "selected": 1
    },
    {
        "name": "Netherlands",
        "code": "nl",
        "selected": 1
    },
    {
        "name": "Netherlands Antilles",
        "code": "an",
        "selected": 1
    },
    {
        "name": "New Caledonia",
        "code": "nc",
        "selected": 1
    },
    {
        "name": "New Zealand",
        "code": "nz",
        "selected": 1
    },
    {
        "name": "Nicaragua",
        "code": "ni",
        "selected": 1
    },
    {
        "name": "Niger",
        "code": "ne",
        "selected": 1
    },
    {
        "name": "Nigeria",
        "code": "ng",
        "selected": 1
    },
    {
        "name": "Niue",
        "code": "nu",
        "selected": 1
    },
    {
        "name": "Norfolk Island",
        "code": "nf",
        "selected": 1
    },
    {
        "name": "Northern Mariana Islands",
        "code": "mp",
        "selected": 1
    },
    {
        "name": "Norway",
        "code": "no",
        "selected": 1
    },
    {
        "name": "Oman",
        "code": "om",
        "selected": 1
    },
    {
        "name": "Pakistan",
        "code": "pk",
        "selected": 1
    },
    {
        "name": "Palau",
        "code": "pw",
        "selected": 1
    },
    {
        "name": "Palestinian Territory, Occupied",
        "code": "ps",
        "selected": 1
    },
    {
        "name": "Panama",
        "code": "pa",
        "selected": 1
    },
    {
        "name": "Papua New Guinea",
        "code": "pg",
        "selected": 1
    },
    {
        "name": "Paraguay",
        "code": "py",
        "selected": 1
    },
    {
        "name": "Peru",
        "code": "pe",
        "selected": 1
    },
    {
        "name": "Philippines",
        "code": "ph",
        "selected": 1
    },
    {
        "name": "Pitcairn",
        "code": "pn",
        "selected": 1
    },
    {
        "name": "Poland",
        "code": "pl",
        "selected": 1
    },
    {
        "name": "Portugal",
        "code": "pt",
        "selected": 1
    },
    {
        "name": "Puerto Rico",
        "code": "pr",
        "selected": 1
    },
    {
        "name": "Qatar",
        "code": "qa",
        "selected": 1
    },
    {
        "name": "Reunion",
        "code": "re",
        "selected": 1
    },
    {
        "name": "Romania",
        "code": "ro",
        "selected": 1
    },
    {
        "name": "Russian Federation",
        "code": "ru",
        "selected": 1
    },
    {
        "name": "RWANDA",
        "code": "rw",
        "selected": 1
    },
    {
        "name": "Saint Helena",
        "code": "sh",
        "selected": 1
    },
    {
        "name": "Saint Kitts and Nevis",
        "code": "kn",
        "selected": 1
    },
    {
        "name": "Saint Lucia",
        "code": "lc",
        "selected": 1
    },
    {
        "name": "Saint Pierre and Miquelon",
        "code": "pm",
        "selected": 1
    },
    {
        "name": "Saint Vincent and the Grenadines",
        "code": "vc",
        "selected": 1
    },
    {
        "name": "Samoa",
        "code": "ws",
        "selected": 1
    },
    {
        "name": "San Marino",
        "code": "sm",
        "selected": 1
    },
    {
        "name": "Sao Tome and Principe",
        "code": "st",
        "selected": 1
    },
    {
        "name": "Saudi Arabia",
        "code": "sa",
        "selected": 1
    },
    {
        "name": "Senegal",
        "code": "sn",
        "selected": 1
    },
    {
        "name": "Serbia",
        "code": "rs",
        "selected": 1
    },
    {
        "name": "Montenegro",
        "code": "me",
        "selected": 1
    },
    {
        "name": "Seychelles",
        "code": "sc",
        "selected": 1
    },
    {
        "name": "Sierra Leone",
        "code": "sl",
        "selected": 1
    },
    {
        "name": "Singapore",
        "code": "sg",
        "selected": 1
    },
    {
        "name": "Slovakia",
        "code": "sk",
        "selected": 1
    },
    {
        "name": "Slovenia",
        "code": "si",
        "selected": 1
    },
    {
        "name": "Solomon Islands",
        "code": "sb",
        "selected": 1
    },
    {
        "name": "Somalia",
        "code": "so",
        "selected": 1
    },
    {
        "name": "South Africa",
        "code": "za",
        "selected": 1
    },
    {
        "name": "South Georgia and the South Sandwich Islands",
        "code": "gs",
        "selected": 1
    },
    {
        "name": "Spain",
        "code": "es",
        "selected": 1
    },
    {
        "name": "Sri Lanka",
        "code": "lk",
        "selected": 1
    },
    {
        "name": "Sudan",
        "code": "sd",
        "selected": 1
    },
    {
        "name": "Suriname",
        "code": "sr",
        "selected": 1
    },
    {
        "name": "Svalbard and Jan Mayen",
        "code": "sj",
        "selected": 1
    },
    {
        "name": "Swaziland",
        "code": "sz",
        "selected": 1
    },
    {
        "name": "Sweden",
        "code": "se",
        "selected": 1
    },
    {
        "name": "Switzerland",
        "code": "ch",
        "selected": 1
    },
    {
        "name": "Syrian Arab Republic",
        "code": "sy",
        "selected": 1
    },
    {
        "name": "Taiwan, Province of China",
        "code": "tw",
        "selected": 1
    },
    {
        "name": "Tajikistan",
        "code": "tj",
        "selected": 1
    },
    {
        "name": "Tanzania, United Republic of",
        "code": "tz",
        "selected": 1
    },
    {
        "name": "Thailand",
        "code": "th",
        "selected": 1
    },
    {
        "name": "Timor-Leste",
        "code": "tl",
        "selected": 1
    },
    {
        "name": "Togo",
        "code": "tg",
        "selected": 1
    },
    {
        "name": "Tokelau",
        "code": "tk",
        "selected": 1
    },
    {
        "name": "Tonga",
        "code": "to",
        "selected": 1
    },
    {
        "name": "Trinidad and Tobago",
        "code": "tt",
        "selected": 1
    },
    {
        "name": "Tunisia",
        "code": "tn",
        "selected": 1
    },
    {
        "name": "Turkey",
        "code": "tr",
        "selected": 1
    },
    {
        "name": "Turkmenistan",
        "code": "tm",
        "selected": 1
    },
    {
        "name": "Turks and Caicos Islands",
        "code": "tc",
        "selected": 1
    },
    {
        "name": "Tuvalu",
        "code": "tv",
        "selected": 1
    },
    {
        "name": "Uganda",
        "code": "ug",
        "selected": 1
    },
    {
        "name": "Ukraine",
        "code": "ua",
        "selected": 1
    },
    {
        "name": "United Arab Emirates",
        "code": "ae",
        "selected": 1
    },
    {
        "name": "United Kingdom",
        "code": "gb",
        "selected": 1
    },
    {
        "name": "United States",
        "code": "us",
        "selected": 1
    },
    {
        "name": "United States Minor Outlying Islands",
        "code": "um",
        "selected": 1
    },
    {
        "name": "Uruguay",
        "code": "uy",
        "selected": 1
    },
    {
        "name": "Uzbekistan",
        "code": "uz",
        "selected": 1
    },
    {
        "name": "Vanuatu",
        "code": "vu",
        "selected": 1
    },
    {
        "name": "Venezuela",
        "code": "ve",
        "selected": 1
    },
    {
        "name": "Viet Nam",
        "code": "vn",
        "selected": 1
    },
    {
        "name": "Virgin Islands, British",
        "code": "vg",
        "selected": 1
    },
    {
        "name": "Virgin Islands, U.S.",
        "code": "vi",
        "selected": 1
    },
    {
        "name": "Wallis and Futuna",
        "code": "wf",
        "selected": 1
    },
    {
        "name": "Western Sahara",
        "code": "eh",
        "selected": 1
    },
    {
        "name": "Yemen",
        "code": "ye",
        "selected": 1
    },
    {
        "name": "Zambia",
        "code": "zm",
        "selected": 1
    },
    {
        "name": "Zimbabwe",
        "code": "zw",
        "selected": 1
    }
];

var allselected = true;
var checkboxes = document.getElementById("checkboxes");
const FLAG_PATH = "_resources/themes/mosaic/dist/flags/";

addCountries();

function addCountries() {
    checkboxes.innerHTML += '<label/><input id="500" type="checkbox" onclick="selectCountry(500)" checked/>All Countries</label>';
    for (i = 0; i < countries.length; i++) {
        if(countries[i].selected == 1){
            checkboxes.innerHTML += '<label/><input id='+ i +' type="checkbox" onclick="selectCountry('+i+')" checked/><img src="'+ FLAG_PATH + countries[i].code +'.png"/>' + countries[i].name + '</label>';
        }else{
            checkboxes.innerHTML += '<label/><input id='+ i +' type="checkbox" onclick="selectCountry('+i+')"/><img src="'+ FLAG_PATH + countries[i].code +'.png"/>' + countries[i].name + '</label>';
        }
    }
    updateCheckbox();
}

var expanded = false;

function showCheckboxes() {
  var checkboxes = document.getElementById("checkboxes");
  if (!expanded) {
    checkboxes.style.display = "block";
    expanded = true;
  } else {
    checkboxes.style.display = "none";
    expanded = false;
  }
}


function updateCheckbox(){
    //check URL if we already have countries selected
    var url = new URL(window.location.href);

    if(url.searchParams.get("countries")){
        const codelist = url.searchParams.get("countries").split(",");

        for (let i = 0; i < countries.length; i++) {

            if(codelist.includes(countries[i].code)){
                countries[i].selected = 1;
            }
            else{
                countries[i].selected = 0;
            }
            
        }

        
        allselected = false;
        document.getElementById(500).checked = false;

    }

    const inputElements = checkboxes.querySelectorAll("input");
    for (let i = 1; i < inputElements.length; i++) {            //Ignore the first one since its all countries
        document.getElementById(inputElements[i].id).checked = countries[inputElements[i].id].selected;
    }
}

function getSelectedCountries(){
    var code = new Array();

    countries.forEach(country => {
        if(country.selected == 1){
            code.push(country.code);
        }
    });

    return code;
}

function selectCountry(id){
    if(id == 500 && document.getElementById(500).checked == true){
        countries.forEach(country => {
            country.selected = 1
        });
        allselected = true;
    }else if(id == 500 && document.getElementById(500).checked == false){
        countries.forEach(country => {
            country.selected = 0
        });
        allselected = false;
    }
    else if(id > countries.length){
        console.log("Selected country out of range");
    }else{
        if(countries[id].selected == 1){        //unselect country
            countries[id].selected = 0;
        }else{
            countries[id].selected = 1;         //select country
        }
    }
    updateCheckbox();
}

function sendCountries() {                      //Refresh the website with the country query 
    var url = new URL(window.location.href);

    if(allselected){
        window.location.replace(url);

    }else{
        url.searchParams.set("countries", getSelectedCountries());
        window.location.replace(url);
    }
}
