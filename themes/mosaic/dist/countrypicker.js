var countries = [
    {
        name: "Afghanistan",
        code: "af",
        selected: true,
    },
    {
        name: "Ã…land Islands",
        code: "ax",
        selected: true,
    },
    {
        name: "Albania",
        code: "al",
        selected: true,
    },
    {
        name: "Algeria",
        code: "dz",
        selected: true,
    },
    {
        name: "American Samoa",
        code: "as",
        selected: true,
    },
    {
        name: "Andorra",
        code: "ad",
        selected: true,
    },
    {
        name: "Angola",
        code: "ao",
        selected: true,
    },
    {
        name: "Anguilla",
        code: "ai",
        selected: true,
    },
    {
        name: "Antarctica",
        code: "aq",
        selected: true,
    },
    {
        name: "Antigua and Barbuda",
        code: "ag",
        selected: true,
    },
    {
        name: "Argentina",
        code: "ar",
        selected: true,
    },
    {
        name: "Armenia",
        code: "am",
        selected: true,
    },
    {
        name: "Aruba",
        code: "aw",
        selected: true,
    },
    {
        name: "Australia",
        code: "au",
        selected: true,
    },
    {
        name: "Austria",
        code: "at",
        selected: true,
    },
    {
        name: "Azerbaijan",
        code: "az",
        selected: true,
    },
    {
        name: "Bahamas",
        code: "bs",
        selected: true,
    },
    {
        name: "Bahrain",
        code: "bh",
        selected: true,
    },
    {
        name: "Bangladesh",
        code: "bd",
        selected: true,
    },
    {
        name: "Barbados",
        code: "bb",
        selected: true,
    },
    {
        name: "Belarus",
        code: "by",
        selected: true,
    },
    {
        name: "Belgium",
        code: "be",
        selected: true,
    },
    {
        name: "Belize",
        code: "bz",
        selected: true,
    },
    {
        name: "Benin",
        code: "bj",
        selected: true,
    },
    {
        name: "Bermuda",
        code: "bm",
        selected: true,
    },
    {
        name: "Bhutan",
        code: "bt",
        selected: true,
    },
    {
        name: "Bolivia",
        code: "bo",
        selected: true,
    },
    {
        name: "Bosnia and Herzegovina",
        code: "ba",
        selected: true,
    },
    {
        name: "Botswana",
        code: "bw",
        selected: true,
    },
    {
        name: "Bouvet Island",
        code: "bv",
        selected: true,
    },
    {
        name: "Brazil",
        code: "br",
        selected: true,
    },
    {
        name: "British Indian Ocean Territory",
        code: "io",
        selected: true,
    },
    {
        name: "Brunei Darussalam",
        code: "bn",
        selected: true,
    },
    {
        name: "Bulgaria",
        code: "bg",
        selected: true,
    },
    {
        name: "Burkina Faso",
        code: "bf",
        selected: true,
    },
    {
        name: "Burundi",
        code: "bi",
        selected: true,
    },
    {
        name: "Cambodia",
        code: "kh",
        selected: true,
    },
    {
        name: "Cameroon",
        code: "cm",
        selected: true,
    },
    {
        name: "Canada",
        code: "ca",
        selected: true,
    },
    {
        name: "Cape Verde",
        code: "cv",
        selected: true,
    },
    {
        name: "Cayman Islands",
        code: "ky",
        selected: true,
    },
    {
        name: "Central African Republic",
        code: "cf",
        selected: true,
    },
    {
        name: "Chad",
        code: "td",
        selected: true,
    },
    {
        name: "Chile",
        code: "cl",
        selected: true,
    },
    {
        name: "China",
        code: "cn",
        selected: true,
    },
    {
        name: "Christmas Island",
        code: "cx",
        selected: true,
    },
    {
        name: "Cocos (Keeling) Islands",
        code: "cc",
        selected: true,
    },
    {
        name: "Colombia",
        code: "co",
        selected: true,
    },
    {
        name: "Comoros",
        code: "km",
        selected: true,
    },
    {
        name: "Congo",
        code: "cg",
        selected: true,
    },
    {
        name: "Congo, The Democratic Republic of the",
        code: "cd",
        selected: true,
    },
    {
        name: "Cook Islands",
        code: "ck",
        selected: true,
    },
    {
        name: "Costa Rica",
        code: "cr",
        selected: true,
    },
    {
        name: 'Cote D"Ivoire',
        code: "ci",
        selected: true,
    },
    {
        name: "Croatia",
        code: "hr",
        selected: true,
    },
    {
        name: "Cuba",
        code: "cu",
        selected: true,
    },
    {
        name: "Cyprus",
        code: "cy",
        selected: true,
    },
    {
        name: "Czech Republic",
        code: "cz",
        selected: true,
    },
    {
        name: "Denmark",
        code: "dk",
        selected: true,
    },
    {
        name: "Djibouti",
        code: "dj",
        selected: true,
    },
    {
        name: "Dominica",
        code: "dm",
        selected: true,
    },
    {
        name: "Dominican Republic",
        code: "do",
        selected: true,
    },
    {
        name: "Ecuador",
        code: "ec",
        selected: true,
    },
    {
        name: "Egypt",
        code: "eg",
        selected: true,
    },
    {
        name: "El Salvador",
        code: "sv",
        selected: true,
    },
    {
        name: "Equatorial Guinea",
        code: "gq",
        selected: true,
    },
    {
        name: "Eritrea",
        code: "er",
        selected: true,
    },
    {
        name: "Estonia",
        code: "ee",
        selected: true,
    },
    {
        name: "Ethiopia",
        code: "et",
        selected: true,
    },
    {
        name: "Falkland Islands (Malvinas)",
        code: "fk",
        selected: true,
    },
    {
        name: "Faroe Islands",
        code: "fo",
        selected: true,
    },
    {
        name: "Fiji",
        code: "fj",
        selected: true,
    },
    {
        name: "Finland",
        code: "fi",
        selected: true,
    },
    {
        name: "France",
        code: "fr",
        selected: true,
    },
    {
        name: "French Guiana",
        code: "gf",
        selected: true,
    },
    {
        name: "French Polynesia",
        code: "pf",
        selected: true,
    },
    {
        name: "French Southern Territories",
        code: "tf",
        selected: true,
    },
    {
        name: "Gabon",
        code: "ga",
        selected: true,
    },
    {
        name: "Gambia",
        code: "gm",
        selected: true,
    },
    {
        name: "Georgia",
        code: "ge",
        selected: true,
    },
    {
        name: "Germany",
        code: "de",
        selected: true,
    },
    {
        name: "Ghana",
        code: "gh",
        selected: true,
    },
    {
        name: "Gibraltar",
        code: "gi",
        selected: true,
    },
    {
        name: "Greece",
        code: "gr",
        selected: true,
    },
    {
        name: "Greenland",
        code: "gl",
        selected: true,
    },
    {
        name: "Grenada",
        code: "gd",
        selected: true,
    },
    {
        name: "Guadeloupe",
        code: "gp",
        selected: true,
    },
    {
        name: "Guam",
        code: "gu",
        selected: true,
    },
    {
        name: "Guatemala",
        code: "gt",
        selected: true,
    },
    {
        name: "Guernsey",
        code: "gg",
        selected: true,
    },
    {
        name: "Guinea",
        code: "gn",
        selected: true,
    },
    {
        name: "Guinea-Bissau",
        code: "gw",
        selected: true,
    },
    {
        name: "Guyana",
        code: "gy",
        selected: true,
    },
    {
        name: "Haiti",
        code: "ht",
        selected: true,
    },
    {
        name: "Heard Island and Mcdonald Islands",
        code: "hm",
        selected: true,
    },
    {
        name: "Holy See (Vatican City State)",
        code: "va",
        selected: true,
    },
    {
        name: "Honduras",
        code: "hn",
        selected: true,
    },
    {
        name: "Hong Kong",
        code: "hk",
        selected: true,
    },
    {
        name: "Hungary",
        code: "hu",
        selected: true,
    },
    {
        name: "Iceland",
        code: "is",
        selected: true,
    },
    {
        name: "India",
        code: "in",
        selected: true,
    },
    {
        name: "Indonesia",
        code: "id",
        selected: true,
    },
    {
        name: "Iran, Islamic Republic Of",
        code: "ir",
        selected: true,
    },
    {
        name: "Iraq",
        code: "iq",
        selected: true,
    },
    {
        name: "Ireland",
        code: "ie",
        selected: true,
    },
    {
        name: "Isle of Man",
        code: "im",
        selected: true,
    },
    {
        name: "Israel",
        code: "il",
        selected: true,
    },
    {
        name: "Italy",
        code: "it",
        selected: true,
    },
    {
        name: "Jamaica",
        code: "jm",
        selected: true,
    },
    {
        name: "Japan",
        code: "jp",
        selected: true,
    },
    {
        name: "Jersey",
        code: "je",
        selected: true,
    },
    {
        name: "Jordan",
        code: "jo",
        selected: true,
    },
    {
        name: "Kazakhstan",
        code: "kz",
        selected: true,
    },
    {
        name: "Kenya",
        code: "ke",
        selected: true,
    },
    {
        name: "Kiribati",
        code: "ki",
        selected: true,
    },
    {
        name: 'Korea, Democratic People"S Republic of',
        code: "kp",
        selected: true,
    },
    {
        name: "Korea, Republic of",
        code: "kr",
        selected: true,
    },
    {
        name: "Kuwait",
        code: "kw",
        selected: true,
    },
    {
        name: "Kyrgyzstan",
        code: "kg",
        selected: true,
    },
    {
        name: 'Lao People"S Democratic Republic',
        code: "la",
        selected: true,
    },
    {
        name: "Latvia",
        code: "lv",
        selected: true,
    },
    {
        name: "Lebanon",
        code: "lb",
        selected: true,
    },
    {
        name: "Lesotho",
        code: "ls",
        selected: true,
    },
    {
        name: "Liberia",
        code: "lr",
        selected: true,
    },
    {
        name: "Libyan Arab Jamahiriya",
        code: "ly",
        selected: true,
    },
    {
        name: "Liechtenstein",
        code: "li",
        selected: true,
    },
    {
        name: "Lithuania",
        code: "lt",
        selected: true,
    },
    {
        name: "Luxembourg",
        code: "lu",
        selected: true,
    },
    {
        name: "Macao",
        code: "mo",
        selected: true,
    },
    {
        name: "Macedonia, The Former Yugoslav Republic of",
        code: "mk",
        selected: true,
    },
    {
        name: "Madagascar",
        code: "mg",
        selected: true,
    },
    {
        name: "Malawi",
        code: "mw",
        selected: true,
    },
    {
        name: "Malaysia",
        code: "my",
        selected: true,
    },
    {
        name: "Maldives",
        code: "mv",
        selected: true,
    },
    {
        name: "Mali",
        code: "ml",
        selected: true,
    },
    {
        name: "Malta",
        code: "mt",
        selected: true,
    },
    {
        name: "Marshall Islands",
        code: "mh",
        selected: true,
    },
    {
        name: "Martinique",
        code: "mq",
        selected: true,
    },
    {
        name: "Mauritania",
        code: "mr",
        selected: true,
    },
    {
        name: "Mauritius",
        code: "mu",
        selected: true,
    },
    {
        name: "Mayotte",
        code: "yt",
        selected: true,
    },
    {
        name: "Mexico",
        code: "mx",
        selected: true,
    },
    {
        name: "Micronesia, Federated States of",
        code: "fm",
        selected: true,
    },
    {
        name: "Moldova, Republic of",
        code: "md",
        selected: true,
    },
    {
        name: "Monaco",
        code: "mc",
        selected: true,
    },
    {
        name: "Mongolia",
        code: "mn",
        selected: true,
    },
    {
        name: "Montserrat",
        code: "ms",
        selected: true,
    },
    {
        name: "Morocco",
        code: "ma",
        selected: true,
    },
    {
        name: "Mozambique",
        code: "mz",
        selected: true,
    },
    {
        name: "Myanmar",
        code: "mm",
        selected: true,
    },
    {
        name: "Namibia",
        code: "na",
        selected: true,
    },
    {
        name: "Nauru",
        code: "nr",
        selected: true,
    },
    {
        name: "Nepal",
        code: "np",
        selected: true,
    },
    {
        name: "Netherlands",
        code: "nl",
        selected: true,
    },
    {
        name: "Netherlands Antilles",
        code: "an",
        selected: true,
    },
    {
        name: "New Caledonia",
        code: "nc",
        selected: true,
    },
    {
        name: "New Zealand",
        code: "nz",
        selected: true,
    },
    {
        name: "Nicaragua",
        code: "ni",
        selected: true,
    },
    {
        name: "Niger",
        code: "ne",
        selected: true,
    },
    {
        name: "Nigeria",
        code: "ng",
        selected: true,
    },
    {
        name: "Niue",
        code: "nu",
        selected: true,
    },
    {
        name: "Norfolk Island",
        code: "nf",
        selected: true,
    },
    {
        name: "Northern Mariana Islands",
        code: "mp",
        selected: true,
    },
    {
        name: "Norway",
        code: "no",
        selected: true,
    },
    {
        name: "Oman",
        code: "om",
        selected: true,
    },
    {
        name: "Pakistan",
        code: "pk",
        selected: true,
    },
    {
        name: "Palau",
        code: "pw",
        selected: true,
    },
    {
        name: "Palestinian Territory, Occupied",
        code: "ps",
        selected: true,
    },
    {
        name: "Panama",
        code: "pa",
        selected: true,
    },
    {
        name: "Papua New Guinea",
        code: "pg",
        selected: true,
    },
    {
        name: "Paraguay",
        code: "py",
        selected: true,
    },
    {
        name: "Peru",
        code: "pe",
        selected: true,
    },
    {
        name: "Philippines",
        code: "ph",
        selected: true,
    },
    {
        name: "Pitcairn",
        code: "pn",
        selected: true,
    },
    {
        name: "Poland",
        code: "pl",
        selected: true,
    },
    {
        name: "Portugal",
        code: "pt",
        selected: true,
    },
    {
        name: "Puerto Rico",
        code: "pr",
        selected: true,
    },
    {
        name: "Qatar",
        code: "qa",
        selected: true,
    },
    {
        name: "Reunion",
        code: "re",
        selected: true,
    },
    {
        name: "Romania",
        code: "ro",
        selected: true,
    },
    {
        name: "Russian Federation",
        code: "ru",
        selected: true,
    },
    {
        name: "RWANDA",
        code: "rw",
        selected: true,
    },
    {
        name: "Saint Helena",
        code: "sh",
        selected: true,
    },
    {
        name: "Saint Kitts and Nevis",
        code: "kn",
        selected: true,
    },
    {
        name: "Saint Lucia",
        code: "lc",
        selected: true,
    },
    {
        name: "Saint Pierre and Miquelon",
        code: "pm",
        selected: true,
    },
    {
        name: "Saint Vincent and the Grenadines",
        code: "vc",
        selected: true,
    },
    {
        name: "Samoa",
        code: "ws",
        selected: true,
    },
    {
        name: "San Marino",
        code: "sm",
        selected: true,
    },
    {
        name: "Sao Tome and Principe",
        code: "st",
        selected: true,
    },
    {
        name: "Saudi Arabia",
        code: "sa",
        selected: true,
    },
    {
        name: "Senegal",
        code: "sn",
        selected: true,
    },
    {
        name: "Serbia",
        code: "rs",
        selected: true,
    },
    {
        name: "Montenegro",
        code: "me",
        selected: true,
    },
    {
        name: "Seychelles",
        code: "sc",
        selected: true,
    },
    {
        name: "Sierra Leone",
        code: "sl",
        selected: true,
    },
    {
        name: "Singapore",
        code: "sg",
        selected: true,
    },
    {
        name: "Slovakia",
        code: "sk",
        selected: true,
    },
    {
        name: "Slovenia",
        code: "si",
        selected: true,
    },
    {
        name: "Solomon Islands",
        code: "sb",
        selected: true,
    },
    {
        name: "Somalia",
        code: "so",
        selected: true,
    },
    {
        name: "South Africa",
        code: "za",
        selected: true,
    },
    {
        name: "South Georgia and the South Sandwich Islands",
        code: "gs",
        selected: true,
    },
    {
        name: "Spain",
        code: "es",
        selected: true,
    },
    {
        name: "Sri Lanka",
        code: "lk",
        selected: true,
    },
    {
        name: "Sudan",
        code: "sd",
        selected: true,
    },
    {
        name: "Suriname",
        code: "sr",
        selected: true,
    },
    {
        name: "Svalbard and Jan Mayen",
        code: "sj",
        selected: true,
    },
    {
        name: "Swaziland",
        code: "sz",
        selected: true,
    },
    {
        name: "Sweden",
        code: "se",
        selected: true,
    },
    {
        name: "Switzerland",
        code: "ch",
        selected: true,
    },
    {
        name: "Syrian Arab Republic",
        code: "sy",
        selected: true,
    },
    {
        name: "Taiwan, Province of China",
        code: "tw",
        selected: true,
    },
    {
        name: "Tajikistan",
        code: "tj",
        selected: true,
    },
    {
        name: "Tanzania, United Republic of",
        code: "tz",
        selected: true,
    },
    {
        name: "Thailand",
        code: "th",
        selected: true,
    },
    {
        name: "Timor-Leste",
        code: "tl",
        selected: true,
    },
    {
        name: "Togo",
        code: "tg",
        selected: true,
    },
    {
        name: "Tokelau",
        code: "tk",
        selected: true,
    },
    {
        name: "Tonga",
        code: "to",
        selected: true,
    },
    {
        name: "Trinidad and Tobago",
        code: "tt",
        selected: true,
    },
    {
        name: "Tunisia",
        code: "tn",
        selected: true,
    },
    {
        name: "Turkey",
        code: "tr",
        selected: true,
    },
    {
        name: "Turkmenistan",
        code: "tm",
        selected: true,
    },
    {
        name: "Turks and Caicos Islands",
        code: "tc",
        selected: true,
    },
    {
        name: "Tuvalu",
        code: "tv",
        selected: true,
    },
    {
        name: "Uganda",
        code: "ug",
        selected: true,
    },
    {
        name: "Ukraine",
        code: "ua",
        selected: true,
    },
    {
        name: "United Arab Emirates",
        code: "ae",
        selected: true,
    },
    {
        name: "United Kingdom",
        code: "gb",
        selected: true,
    },
    {
        name: "United States",
        code: "us",
        selected: true,
    },
    {
        name: "United States Minor Outlying Islands",
        code: "um",
        selected: true,
    },
    {
        name: "Uruguay",
        code: "uy",
        selected: true,
    },
    {
        name: "Uzbekistan",
        code: "uz",
        selected: true,
    },
    {
        name: "Vanuatu",
        code: "vu",
        selected: true,
    },
    {
        name: "Venezuela",
        code: "ve",
        selected: true,
    },
    {
        name: "Viet Nam",
        code: "vn",
        selected: true,
    },
    {
        name: "Virgin Islands, British",
        code: "vg",
        selected: true,
    },
    {
        name: "Virgin Islands, U.S.",
        code: "vi",
        selected: true,
    },
    {
        name: "Wallis and Futuna",
        code: "wf",
        selected: true,
    },
    {
        name: "Western Sahara",
        code: "eh",
        selected: true,
    },
    {
        name: "Yemen",
        code: "ye",
        selected: true,
    },
    {
        name: "Zambia",
        code: "zm",
        selected: true,
    },
    {
        name: "Zimbabwe",
        code: "zw",
        selected: true,
    },
];

var allSelected = true;
var expanded = false;
var checkboxes = document.getElementById("checkboxes");
const FLAG_PATH = "_resources/themes/mosaic/dist/flags/";

addCountries();

function addCountries() {
    checkboxes.innerHTML +=
        '<label><input id="500" type="checkbox" onclick="selectCountry(500)" checked/>All Countries</label>';
    for (i = 0; i < countries.length; i++) {
        checkboxes.innerHTML += `<label>
            <input id="${i}" type="checkbox" onclick="selectCountry(${i})" 
                ${countries[i].selected ? "" : "checked"}
            />
            <img src="${FLAG_PATH + countries[i].code}.png" loading="lazy">
            ${countries[i].name}
        </label>`;
    }
    updateCheckbox();
}

function showCheckboxes() {
    expanded = !expanded;
    if (expanded) {
        checkboxes.style.display = "block";
    } else {
        checkboxes.style.display = "none";
    }
}

// ======================================================
// ==== TODO: Split into render() and update() functions ====
// ======================================================
function updateCheckbox() {
    //check URL if we already have countries selected
    var url = new URL(window.location.href);

    if (url.searchParams.get("countries")) {
        const codelist = url.searchParams.get("countries").split(",");

        for (let i = 0; i < countries.length; i++) {
            if (codelist.includes(countries[i].code)) {
                countries[i].selected = true;
            } else {
                countries[i].selected = false;
            }
        }

        allSelected = false;
        document.getElementById(500).checked = false;
    }

    const inputElements = checkboxes.querySelectorAll("input");
    //Ignore the first one since its all countries
    for (let i = 1; i < inputElements.length; i++) {
        document.getElementById(inputElements[i].id).checked =
            countries[inputElements[i].id].selected;
    }
}

function getSelectedCountries() {
    var code = new Array();

    countries.forEach((country) => {
        if (country.selected) {
            code.push(country.code);
        }
    });

    return code;
}

function selectCountry(id) {
    if (id == 500) {
        allSelected = document.getElementById(500).checked;
        countries.forEach((country) => {
            country.selected = allSelected;
        });
    } else if (id > countries.length) {
        console.log("Selected country out of range");
    } else {
        allSelected = false;
        countries[id].selected = !countries[id].selected;
    }
    updateCheckbox();
}

//Refresh the website with the country query
function sendCountries() {
    var url = new URL(window.location.href);

    if (allSelected) {
        window.location.replace(url);
    } else {
        url.searchParams.set("countries", getSelectedCountries());
        window.location.replace(url);
    }
}
